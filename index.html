<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <title>股市!</title>

</head>

<body>

<script type="text/javascript">
    var dataset = [
        ['2017-01-03', 9252.56, 9235.95, 9273.65, 9272.88, 2490220049.00, 46113898863.00],
        ['2017-01-04', 9279.52,	9266.03, 9299.62, 9286.96, 2902225383.00, 57298745336.00],
        ['2017-01-05', 9282.56,	9282.45, 9358.42, 9358.14, 3925580780.00, 77570633083.00],
        ['2017-01-06', 9371.41,	9351.25, 9381.11, 9372.22, 3607840930.00, 70913380389.00],
        ['2017-01-09', 9376.48,	9328.19, 9404.90, 9342.42, 3551476599.00, 64708958882.00],
        ['2017-01-10', 9344.19,	9319.45, 9353.60, 9349.64, 3289324247.00, 60598143249.00],
        ['2017-01-11', 9370.17,	9333.49, 9384.00, 9345.74, 3680625074.00, 73941460978.00],
        ['2017-01-12', 9356.12,	9356.12, 9430.58, 9410.18, 3771167251.00, 77843540798.00],
        ['2017-01-13', 9373.70,	9352.08, 9387.68, 9378.83, 3293064718.00, 72909568901.00],
        ['2017-01-16', 9356.54,	9281.21, 9359.01, 9292.33, 3066709541.00, 58354654137.00],
        ['2017-01-17', 9301.96,	9294.68, 9354.53, 9354.53, 3052796892.00, 58879214644.00],
        ['2017-01-18', 9344.74,	9322.44, 9350.95, 9341.97, 3744987831.00, 77677598664.00],
        ['2017-01-19', 9324.83,	9287.54, 9337.64, 9318.12, 3614825738.00, 81677909780.00],
        ['2017-01-20', 9326.80,	9317.62, 9350.07, 9331.46, 3098080735.00, 72733394069.00],
        ['2017-01-23', 9363.66,	9363.66, 9427.46, 9424.05, 3219340160.00, 78442540687.00],
        ['2017-01-24', 9423.05,	9416.06, 9468.34, 9447.95, 3362191880.00, 90355629176.00],
        ['2017-02-02', 9502.25, 9413.77, 9521.34, 9428.97, 5119534614.00, 147930853630.00],
        ['2017-02-03', 9450.06, 9423.93, 9478.01, 9455.56, 5068371711.00, 102335722986.00],
        ['2017-02-06', 9467.67, 9467.67, 9548.68, 9538.01, 5510906552.00, 102352501152.00],
        ['2017-02-07', 9527.42, 9512.56, 9555.80, 9554.56, 4932873379.00, 95709593373.00],
        ['2017-02-08', 9540.77, 9505.79, 9564.07, 9543.25, 5300856389.00, 110729308207.00],
        ['2017-02-09', 9555.52, 9540.51, 9600.09, 9590.18, 5264593609.00, 106237084984.00],
        ['2017-02-10', 9612.67, 9612.67, 9688.15, 9665.59, 6240806015.00, 136811826048.00],
        ['2017-02-13', 9690.39, 9681.10, 9711.43, 9710.32, 5255562269.00, 101177702355.00],
        ['2017-02-14', 9726.74, 9698.29, 9760.01, 9718.78, 5531133656.00, 113724121218.00],
        ['2017-02-15', 9724.13, 9723.04, 9813.98, 9799.76, 5748794719.00, 117918064389.00],
        ['2017-02-16', 9826.89, 9753.16, 9869.59, 9771.25, 5167818860.00, 108303272962.00],
        ['2017-02-17', 9779.16, 9754.54, 9791.59, 9759.76, 4358105024.00, 95178870089.00],
        ['2017-02-18', 9771.21, 9770.75, 9791.35, 9779.92, 3411356161.00, 61980819056.00],
        ['2017-02-20', 9795.81, 9743.36, 9781.14, 9753.20, 4750607829.00, 97817579999.00],
        ['2017-02-21', 9761.27, 9721.36, 9775.49, 9763.93, 4604650193.00, 90064360265.00],
        ['2017-02-22', 9786.25, 9770.10, 9820.07, 9778.78, 4853832134.00, 101274785349.00],
        ['2017-02-23', 9774.08, 9748.94, 9810.56, 9769.31, 4622272767.00, 99296651630.00]


    ];

    var dataCnt = dataset.length;
    var w = 500, h = 200;
    var barPadding = 4;

    var svg = d3.select("body").append('svg').attr('width', w).attr('height', h);
        // svg.append('rect').attr('x', 10).attr('y', 10).attr('width', 100).attr('height', 100).attr('fill', 'red');


    var priceMin = d3.min(dataset, function(d) {
            return d3.min(d.slice(1, 5))
        });
    var priceMax = d3.max(dataset, function (d) {
            return d3.max(d.slice(1, 5))
        });
    var yscale = d3.scale.linear()
            .domain([priceMin, priceMax])
            .range([0, h]);

    var rectAttr = {
        'x': function(d, i) {
            return i * (w / dataCnt);
        },
        'y': function (d, i) {
            return h - yscale(d3.max([d[1], d[4]]));
        },
        'width': function(d, i) {
            return w / dataCnt - barPadding;
        },
        'height': function(d, i){
            return Math.abs(yscale(d[1]) - yscale(d[4]));
        },
        'fill': function(d){
            if (d[1] < d[4]) return 'red'
            else return 'green';
        }
    };

    svg.selectAll('rect').data(dataset).enter().append('rect').attr(rectAttr);


    svg.selectAll('line')
        .data(dataset)
        .enter()
        .append('line')
        .attr({
            'x1': function(d, i) {
                return i *(w / dataCnt) + (w / dataCnt - barPadding) / 2;
            },
            'x2': function(d, i){
                return i * (w / dataCnt) + (w / dataCnt - barPadding) / 2;
            },
            'y1': function(d, i){
                return h - yscale(d3.max(d.slice(1,5)));
            },
            'y2': function(d, i){
                return h - yscale(d3.min(d.slice(1, 5)));
            },
            'stroke': function (d) {
                if (d[1] < d[4]) return 'red';
                else return 'green';

            }


        });


</script>







</body>
</html>
